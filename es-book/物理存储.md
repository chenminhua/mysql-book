# 物理存储

divides each index into shards, which can migrate between servers

对于 es 管理员来说，这很重要，因为这决定了性能，可扩展性，可用性

shard: 最小物理单元，可以从一个 node 被搬到另一个 node，默认每个 index 有 5 个 shard

shard 就是 lucene 的 index

sharding for scalability

replicas for reliability and performance

默认情况下，每个 Index 会创建 5 个 primary shard 和 5 个 replica shard，也就是 10 个分片。索引某个文档时，先将文档发给某个主分片，再由主分片发给其副本分片。

主分片或者复制分片都可以处理读请求——搜索或文档检索，所以数据的冗余越多，搜索吞吐量就越大。

## 如何 index 一个文档

首先发送文档到主分片
然后文档被发送到主分片的其他 replicas
in sync 之后，副本就能够提供搜索服务，并且在主分片不能工作时被选为主分片

### 如何删除一个文档

先标记，后异步删除
